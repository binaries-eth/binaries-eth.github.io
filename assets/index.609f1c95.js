var j=Object.defineProperty,q=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var x=(e,t,n)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$=(e,t)=>{for(var n in t||(t={}))z.call(t,n)&&x(e,n,t[n]);if(S)for(var n of S(t))U.call(t,n)&&x(e,n,t[n]);return e},N=(e,t)=>q(e,D(t));import{d as defineComponent,c as computed,r as ref,o as onMounted,w as watchEffect,a as onUnmounted,b as openBlock,e as createElementBlock,f as createBaseVNode,u as unref,n as normalizeClass,t as toDisplayString,g as withModifiers,p as pushScopeId,h as popScopeId,W as Web3Provider,i as reactive,j as watch,k as provide,l as toRefs,m as readonly,q as renderSlot,s as utils,I as InfuraProvider,C as Contract,v as toRaw,B as BigNumber,x as inject,y as createVNode,z as isRef,F as Fragment,A as renderList,D as createCommentVNode,E as createBlock,G as createTextVNode,H as withCtx,J as createApp}from"./vendor.4e4d96d0.js";const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}};p();const mathMethods=Object.getOwnPropertyNames(Math),paramStrings=Array.apply(null,Array(5)).map((e,t)=>`p${t+1}`),stringWhitelist=["x","y",...paramStrings,...mathMethods],uniqueOnly=(e,t,n)=>n.indexOf(e)===t,sanitizeFormula=e=>{var n;e=e.replace(/[^a-zA-Z0-9=<>*+-\/().&^!|%;?:;{} ]/g,""),e=e.replace(/Math\./g,"");const t=(n=e.match(/p[0-9]{1}|[a-zA-Z]+/g))==null?void 0:n.filter(a=>stringWhitelist.indexOf(a)==-1).filter(uniqueOnly);return t==null||t.forEach(a=>{e=e.replaceAll(a,"")}),e},extendWithMath=e=>{var n;e=sanitizeFormula(e);const t=(n=e.match(/p[0-9]{1}|[a-zA-Z]+/g))==null?void 0:n.filter(a=>mathMethods.indexOf(a)>-1).filter(uniqueOnly);return t==null||t.forEach(a=>{e=e.replaceAll(a,`Math.${a}`)}),e};var TokenRenderer_vue_vue_type_style_index_0_scoped_true_lang="",_export_sfc=(e,t)=>{for(const[n,a]of t)e[n]=a;return e};const _hoisted_1$7=["width","height"],_sfc_main$8=defineComponent({props:{formula:null,params:null,size:null,scaled:null,fillStyle:null},setup(__props){const props=__props,formula=computed(()=>extendWithMath(props.formula)),params=computed(()=>props.params),{size}=props,canvas=ref(null),evaled=f=>eval(`({x,y,p1,p2,p3,p4,p5,p6,p7,p8,p9}) => ${f}`),parseParams=e=>Object.fromEntries(e.map((t,n)=>[`p${n+1}`,t])),draw=(e,t,n,a)=>{try{let o=evaled(n),s=parseParams(a);e.clearRect(0,0,t,t);let r=$({},s);for(r.x=-t/2;r.x<t/2;r.x++)for(r.y=-t/2;r.y<t/2;r.y++)o(r)&&e.fillRect(r.x+t/2,r.y+t/2,1,1)}catch(o){console.log(o)}};let stopWatching;return onMounted(()=>{const t=canvas.value.getContext("2d");t.fillStyle=props.fillStyle||"#efefef",stopWatching=watchEffect(()=>draw(t,size,formula.value,params.value))}),onUnmounted(()=>{stopWatching()}),(e,t)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["renderer",{scaled:__props.scaled}])},[createBaseVNode("canvas",{class:"canvas",ref:(n,a)=>{a.canvas=n,canvas.value=n},width:unref(size),height:unref(size)},null,8,_hoisted_1$7)],2))}});var TokenRenderer=_export_sfc(_sfc_main$8,[["__scopeId","data-v-91f07e8a"]]);const _hoisted_1$6={class:"text-input"},_hoisted_2$6=createBaseVNode("label",null,"forumla",-1),_hoisted_3$5=["value"],_sfc_main$7=defineComponent({props:{modelValue:null},emits:["update:modelValue"],setup(e,{emit:t}){const n=o=>{var s;((s=o.key.match(/[^ \[\]a-zA-Z0-9=<>*+-\/().&^!|%;?:]/))==null?void 0:s.length)&&o.preventDefault()},a=o=>{t("update:modelValue",o.target.value)};return(o,s)=>(openBlock(),createElementBlock("div",_hoisted_1$6,[_hoisted_2$6,createBaseVNode("input",{type:"text",value:e.modelValue,onKeydown:s[0]||(s[0]=r=>n(r)),onInput:s[1]||(s[1]=r=>a(r))},null,40,_hoisted_3$5)]))}});var ParameterInput_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1$5={class:"text-input"},_hoisted_2$5=["value"],_hoisted_3$4=["value"],_sfc_main$6=defineComponent({props:{label:null,modelValue:{default:()=>1}},emits:["update:modelValue"],setup(e,{emit:t}){return(n,a)=>(openBlock(),createElementBlock("div",_hoisted_1$5,[createBaseVNode("label",null,toDisplayString(e.label),1),createBaseVNode("input",{type:"number",min:"0",max:"255",value:e.modelValue,onInput:a[0]||(a[0]=o=>t("update:modelValue",parseInt(o.target.value)))},null,40,_hoisted_2$5),createBaseVNode("input",{type:"range",min:"0",max:"255",step:"1",value:e.modelValue,onInput:a[1]||(a[1]=o=>t("update:modelValue",parseInt(o.target.value)))},null,40,_hoisted_3$4)]))}});var ParameterInput=_export_sfc(_sfc_main$6,[["__scopeId","data-v-5ac7c146"]]),MintButton_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId$3=e=>(pushScopeId("data-v-91b8c5c0"),e=e(),popScopeId(),e),_hoisted_1$4=["disabled"],_hoisted_2$4=_withScopeId$3(()=>createBaseVNode("span",{class:"shadow"},null,-1)),_hoisted_3$3=_withScopeId$3(()=>createBaseVNode("span",{class:"edge"},null,-1)),_hoisted_4$3=_withScopeId$3(()=>createBaseVNode("span",{class:"front"}," MINT ",-1)),_hoisted_5$2=[_hoisted_2$4,_hoisted_3$3,_hoisted_4$3],_sfc_main$5=defineComponent({props:{minting:null,disabled:null},emits:["click"],setup(e,{emit:t}){return(n,a)=>(openBlock(),createElementBlock("button",{disabled:e.disabled,class:normalizeClass(["pushable",{minting:e.minting}]),onClick:a[0]||(a[0]=withModifiers(o=>t("click"),["stop","prevent"]))},_hoisted_5$2,10,_hoisted_1$4))}});var MintButton=_export_sfc(_sfc_main$5,[["__scopeId","data-v-91b8c5c0"]]);const initMetamask=async e=>{const t=window.ethereum||window.web3&&window.web3.currentProvider;if(t){const n=new Web3Provider(t,"any");n.on("network",(h,w)=>{d(h.chainId)});const a=ref({}),o=ref([]),s=ref(0),r=h=>{o.value=h,a.value=n.getSigner()},d=h=>{s.value=h};t.on("accountsChanged",r);const i=async()=>{r(await n.listAccounts())};return{signer:a,chainId:s,accounts:o,connect:async()=>{s.value!=e&&await t.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+e.toString(16)}]}),i(),o.value.length==0&&await t.request({method:"eth_requestAccounts"})},checkConnection:i,clearListeners:()=>{t.removeListener("accountsChanged",r)}}}else return Promise.reject("For a start only Metamask \u{1F98A}")},{formatEther}=utils,contractAddress="0xaBd3606A72469e4Dbda2E0c6a3c0Dff7473aa5c3",networkId=parseInt("1"),contractAbi=["function name() view returns (string)","function totalSupply() view returns (uint)","function tokenByIndex(uint index) view returns (uint)","function tokenMetadata(uint tokenId) view returns (tuple(address owner,address minter,string formula,uint8[] params,uint tokenId,uint sequence,uint burnPrice))","function allTokensMetadata() view returns (tuple[](address owner,address minter,string formula,uint8[] params,uint tokenId,uint sequence,uint burnPrice))","function tokenURI(uint tokenId) view returns (string)","function mintPrice(uint totalSupply) view returns (uint)","function burnPrice(uint sequence) view returns (uint)","function mint(string formula, uint8[] params) payable returns (uint)","function getClaimableBalance(address owner) view returns (uint)","function burn(uint tokenId) returns (boolean)","function claim() returns (boolean)"],state=reactive({totalSupply:0,accounts:[],account:computed(()=>state.accounts.length>0&&state.accounts[0].toLowerCase()||""),connected:computed(()=>state.validNetwork&&state.accounts.length>0),contractAddress,signer:void 0,listing:[],network:0,validNetwork:computed(()=>!!state.network&&state.network==networkId),nextPrice:"0",providerError:"",claimableBalance:"0"});let infuraContract;const initInfura=()=>{{const e=new InfuraProvider(networkId,"51db74c752774749a1a8aae509f4cd87");infuraContract=new Contract(contractAddress,contractAbi,e)}},fetchTokenMetadata=async e=>{let t=await infuraContract.tokenMetadata(e).catch(handleVMException);return parseTokenMetadata(t)},fetchMintPrice=async e=>{const t=await infuraContract.mintPrice(e+1);return formatEther(t)};watch(()=>state.totalSupply,async(e,t)=>{state.nextPrice=await fetchMintPrice(e)});const fetchTotalSupply=async()=>{state.totalSupply=(await infuraContract.totalSupply()).toNumber()},fetchClaimableBalance=async e=>formatEther(await infuraContract.getClaimableBalance(e));watch(()=>state.account,async(e,t)=>{e&&e.length>0&&(state.claimableBalance=await fetchClaimableBalance(e))});const parseTokenMetadata=e=>N($({},e),{tokenId:e.tokenId.toNumber(),sequence:e.sequence.toNumber(),burnPrice:formatEther(e.burnPrice)}),fetchListing=async()=>{const e=await infuraContract.allTokensMetadata();state.listing=e.map(parseTokenMetadata).sort((t,n)=>t.tokenId>n.tokenId?-1:1)},mint=async(e,t=[],n)=>{const a=new Contract(contractAddress,contractAbi,toRaw(state.signer)),o=await a.mintPrice(n.value+1),s=await(await a.mint(e,t,{value:o}).catch(handleVMException)).wait().catch(handleVMException),r=BigNumber.from(s.logs[0].topics[3]).toNumber();return handleMintedToken(r),r},burn=async e=>{await(await new Contract(contractAddress,contractAbi,toRaw(state.signer)).burn(e).catch(handleVMException)).wait().catch(handleVMException),handleBurnedToken(e)},claim=async()=>{await(await new Contract(contractAddress,contractAbi,toRaw(state.signer)).claim().catch(handleVMException)).wait().catch(handleVMException)},handleMintedToken=async e=>{let t=await fetchTokenMetadata(e);state.listing.unshift(t),state.totalSupply+=1},handleBurnedToken=e=>{state.listing=state.listing.filter(t=>t.tokenId!=e),state.totalSupply-=1},handleVMException=e=>{let t="";if(e.code==4001)t="Signature rejected";else if(e.data.message&&e.data.message.indexOf("(")>-1){t=e.data.message.match(/'(.*?)'/)[1];let n=t.split("(")[0],a=t.match(/\((.*?)\)/)[1].replace(" ","").split(",");switch(n){case"InsufficientFunds":t=parseInsufficientFunds({available:parseInt(a[0]),required:parseInt(a[1])})}}return Promise.reject(t)},parseInsufficientFunds=e=>`Transaction minumum amount ${e.required} ETH, sent ${e.available} ETH`,ContractStateSymbol=Symbol("Contract state provider identifier"),ContractCallsSymbol=Symbol("Contract calls provider identifier"),_sfc_main$4={setup(){let e;const t=async()=>{try{await e.connect()}catch(n){n.code===4001?handleVMException(n):console.log(n)}};provide(ContractStateSymbol,toRefs(readonly(state))),provide(ContractCallsSymbol,{mint,burn,claim,connect:t,fetchTotalSupply}),onMounted(async()=>{try{e=await initMetamask(networkId)}catch(n){state.providerError=n}e&&(await e.checkConnection(),state.accounts=e.accounts,state.network=e.chainId,state.signer=e.signer,initInfura()),await fetchTotalSupply(),await fetchListing()}),onUnmounted(()=>{e&&e.clearListeners()})}};function _sfc_render(e,t,n,a,o,s){return renderSlot(e.$slots,"default")}var ContractProvider=_export_sfc(_sfc_main$4,[["render",_sfc_render]]),TokenForm_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId$2=e=>(pushScopeId("data-v-f76f7134"),e=e(),popScopeId(),e),_hoisted_1$3={class:"center"},_hoisted_2$3={key:0},_hoisted_3$2={class:"center"},_hoisted_4$2=createTextVNode(" Current price "),_hoisted_5$1={class:"price"},_hoisted_6$1=_withScopeId$2(()=>createBaseVNode("a",{href:"https://github.com/binaries-eth/binaries#tokenomics",class:"link"},"(tokenomics info)",-1)),_hoisted_7={class:"button-container"},_hoisted_8={key:2,href:"https://metamask.io",target:"_blank"},_hoisted_9={key:0,class:"center"},_hoisted_10={key:1,class:"center"},_hoisted_11={class:"error"},_sfc_main$3=defineComponent({props:{formulaValue:null,paramsValues:null},emits:["update:formulaValue","update:paramsValues"],setup(e,{emit:t}){const n=e,{mint:a,burn:o,connect:s,fetchTotalSupply:r}=inject(ContractCallsSymbol),{account:d,connected:i,totalSupply:m,nextPrice:k,listing:h,providerError:w}=inject(ContractStateSymbol),B=computed({get:()=>n.formulaValue,set:l=>t("update:formulaValue",l)}),_=ref({}),b=computed(()=>!!_.value),y=ref(!1),g=ref(""),E=computed(()=>_.value&&_.value.owner&&_.value.owner.toLowerCase()),M=l=>{var c,u;return((u=(c=l.match(/p[0-9]+/g))==null?void 0:c.filter((v,V,F)=>F.indexOf(v)==V))==null?void 0:u.length)||0},C=computed(()=>Object.fromEntries(unref(h).map(l=>[[l.formula,...l.params].join(","),l]))),I=l=>C.value[l.join(",")],A=watch(()=>[n.formulaValue,...n.paramsValues],(l,c)=>{const u=M(l[0]);u!=n.paramsValues.length&&(n.paramsValues.length+=u-n.paramsValues.length,t("update:paramsValues",Array.apply(null,n.paramsValues).map(v=>v||1))),_.value=I(l)});watch(()=>C.value,()=>{_.value=I([n.formulaValue,...n.paramsValues])});const P=async()=>{y.value=!0;const l=sanitizeFormula(n.formulaValue),c=n.paramsValues;await a(l,c,m).catch(T),y.value=!1},T=async l=>{g.value=l},O=()=>{g.value=""},L=l=>Math.floor(Math.random()*l),R=()=>{t("update:paramsValues",n.paramsValues.map(()=>L(255)))};return onMounted(async()=>{}),onUnmounted(()=>{A()}),(l,c)=>(openBlock(),createElementBlock("div",null,[createVNode(_sfc_main$7,{modelValue:unref(B),"onUpdate:modelValue":c[0]||(c[0]=u=>isRef(B)?B.value=u:null)},null,8,["modelValue"]),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.paramsValues,(u,v)=>(openBlock(),createBlock(ParameterInput,{label:"P"+(v+1),modelValue:e.paramsValues[v],"onUpdate:modelValue":V=>e.paramsValues[v]=V,modelModifiers:{number:!0}},null,8,["label","modelValue","onUpdate:modelValue"]))),256)),createBaseVNode("div",_hoisted_1$3,[unref(b)?(openBlock(),createElementBlock("span",_hoisted_2$3,"These params are already minted ")):createCommentVNode("",!0),createBaseVNode("span",{class:"link",onClick:c[1]||(c[1]=u=>R())},"(randomise)")]),createBaseVNode("div",_hoisted_3$2,[_hoisted_4$2,createBaseVNode("span",_hoisted_5$1,toDisplayString(unref(k))+"\u039E ",1),createBaseVNode("span",{class:"link",onClick:c[2]||(c[2]=u=>unref(r)())},"(refresh)"),_hoisted_6$1]),createBaseVNode("div",_hoisted_7,[unref(i)?(openBlock(),createBlock(MintButton,{key:0,disabled:unref(b)||y.value,minting:y.value,onClick:c[3]||(c[3]=u=>P())},null,8,["disabled","minting"])):unref(w)?unref(w)?(openBlock(),createElementBlock("a",_hoisted_8,"(install Metamask \u{1F98A} to mint)")):createCommentVNode("",!0):(openBlock(),createElementBlock("span",{key:1,class:"link",onClick:c[4]||(c[4]=u=>unref(s)())},"(connect)"))]),unref(E)==unref(d)?(openBlock(),createElementBlock("div",_hoisted_9,[createBaseVNode("span",{class:"link",onClick:c[5]||(c[5]=u=>unref(o)(_.value.tokenId))},"(burn for "+toDisplayString(_.value.burnPrice)+"\u039E)",1)])):createCommentVNode("",!0),g.value?(openBlock(),createElementBlock("div",_hoisted_10,[createBaseVNode("span",_hoisted_11,toDisplayString(g.value),1),createBaseVNode("span",{class:"link",onClick:c[6]||(c[6]=u=>O())}," (OK, close)")])):createCommentVNode("",!0)]))}});var TokenForm=_export_sfc(_sfc_main$3,[["__scopeId","data-v-f76f7134"]]),ConnectButton_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1$2={key:0},_hoisted_2$2={key:1},_hoisted_3$1={key:1},_hoisted_4$1={class:"with_space"},_hoisted_5=createTextVNode(" Accrued "),_hoisted_6={class:"amount"},_sfc_main$2=defineComponent({setup(e){const{connect:t,claim:n}=inject(ContractCallsSymbol),{connected:a,account:o,providerError:s,claimableBalance:r}=inject(ContractStateSymbol);return(d,i)=>(openBlock(),createElementBlock("div",null,[unref(s)?(openBlock(),createElementBlock("div",_hoisted_1$2,toDisplayString(unref(s)),1)):(openBlock(),createElementBlock("div",_hoisted_2$2,[unref(a)?(openBlock(),createElementBlock("div",_hoisted_3$1,[createBaseVNode("span",_hoisted_4$1,[_hoisted_5,createBaseVNode("span",_hoisted_6,toDisplayString(unref(r))+"\u039E ",1),createBaseVNode("span",{class:"link",onClick:i[1]||(i[1]=m=>unref(n)())},"(claim)")]),createBaseVNode("span",null,"Connected as "+toDisplayString(unref(o)),1)])):(openBlock(),createElementBlock("button",{key:0,onClick:i[0]||(i[0]=m=>unref(t)()),ref:(m,k)=>{k.connect_button=m}},"CONNECT",512))]))]))}});var ConnectButton=_export_sfc(_sfc_main$2,[["__scopeId","data-v-f231b372"]]),TokenList_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId$1=e=>(pushScopeId("data-v-9710f82e"),e=e(),popScopeId(),e),_hoisted_1$1=["onClick"],_hoisted_2$1=_withScopeId$1(()=>createBaseVNode("span",{class:"shadow"},null,-1)),_sfc_main$1=defineComponent({emits:["selected"],setup(e,{emit:t}){const n=o=>{const s=JSON.parse(JSON.stringify(o));t("selected",s)},{listing:a}=inject(ContractStateSymbol);return onMounted(async()=>{}),onUnmounted(()=>{}),(o,s)=>(openBlock(),createElementBlock("section",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(a),r=>(openBlock(),createElementBlock("div",{class:"box",onClick:d=>n(r),key:r.tokenId},[_hoisted_2$1,createVNode(TokenRenderer,{class:"front",scaled:"",formula:r.formula,params:r.params,size:512},null,8,["formula","params"])],8,_hoisted_1$1))),128))]))}});var TokenList=_export_sfc(_sfc_main$1,[["__scopeId","data-v-9710f82e"]]),App_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId=e=>(pushScopeId("data-v-beec6956"),e=e(),popScopeId(),e),_hoisted_1={class:"container"},_hoisted_2={class:"navigation"},_hoisted_3=_withScopeId(()=>createBaseVNode("span",{class:"logo"},"BINARIES",-1)),_hoisted_4={class:"grid"},_sfc_main=defineComponent({setup(e){const t=512,n=ref("!((x ^ y) % p1)"),a=ref([7]),o=ref(!1),s=d=>{o.value=d},r=d=>{n.value=d.formula,a.value=d.params};return(d,i)=>(openBlock(),createBlock(ContractProvider,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[_hoisted_3,createVNode(ConnectButton,{onConnected:s})]),createBaseVNode("div",_hoisted_4,[createVNode(TokenRenderer,{class:"shadow",formula:n.value,params:a.value,size:t},null,8,["formula","params"]),createVNode(TokenForm,{class:"editor","formula-value":n.value,"onUpdate:formula-value":i[0]||(i[0]=m=>n.value=m),"params-values":a.value,"onUpdate:params-values":i[1]||(i[1]=m=>a.value=m),connected:o.value},null,8,["formula-value","params-values","connected"])]),createVNode(TokenList,{onSelected:r})])]),_:1}))}});var App=_export_sfc(_sfc_main,[["__scopeId","data-v-beec6956"]]),global="";createApp(App).mount("#app");
