var F=Object.defineProperty,j=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var I=(e,t,n)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,V=(e,t)=>{for(var n in t||(t={}))D.call(t,n)&&I(e,n,t[n]);if(S)for(var n of S(t))U.call(t,n)&&I(e,n,t[n]);return e},N=(e,t)=>j(e,O(t));import{d as defineComponent,t as toRefs,r as ref,o as onMounted,w as watchEffect,a as onUnmounted,b as openBlock,c as createElementBlock,e as createBaseVNode,u as unref,n as normalizeClass,f as toDisplayString,g as withModifiers,p as pushScopeId,h as popScopeId,W as Web3Provider,i as reactive,j as computed,k as watch,l as utils,m as provide,q as readonly,s as renderSlot,I as InfuraProvider,C as Contract,v as toRaw,B as BigNumber,x as inject,y as createVNode,z as isRef,F as Fragment,A as renderList,D as createCommentVNode,E as createBlock,G as createTextVNode,H as withCtx,J as createApp}from"./vendor.36923d65.js";const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}};p();var TokenRenderer_vue_vue_type_style_index_0_scoped_true_lang="",_export_sfc=(e,t)=>{for(const[n,o]of t)e[n]=o;return e};const _hoisted_1$7=["width","height"],_sfc_main$8=defineComponent({props:{formula:{type:String,required:!0},params:{type:Array,required:!0},size:{type:Number,required:!0},scaled:{type:Boolean,required:!1},fillStyle:{type:String,required:!1}},setup(__props){const props=__props,{formula,params}=toRefs(props),canvas=ref(null),{size}=props,sanitizedEval=f=>(f=f.replace(/[^a-zA-Z0-9=<>*+-\/().&^!|%;?:;{}]/g,""),f=f.replace(/canvas|size|document|window|append|get|console|eval|setTimeout|setInterval|new|Function/g,""),eval(`({x,y,p1,p2,p3,p4,p5,p6,p7,p8,p9}) => ${f}`)),parseParams=e=>Object.fromEntries(e.map((t,n)=>[`p${n+1}`,t])),draw=(e,t,n,o)=>{try{let a=sanitizedEval(n),s=parseParams(o);e.clearRect(0,0,t,t);let r=V({},s);for(r.x=-t/2;r.x<t/2;r.x++)for(r.y=-t/2;r.y<t/2;r.y++)a(r)&&e.fillRect(r.x+t/2,r.y+t/2,1,1)}catch(a){console.log(a)}};let stopWatching;return onMounted(()=>{const t=canvas.value.getContext("2d");t.fillStyle=props.fillStyle||"#ddd",stopWatching=watchEffect(()=>draw(t,size,formula.value,params.value))}),onUnmounted(()=>{stopWatching()}),(e,t)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["renderer",{scaled:__props.scaled}])},[createBaseVNode("canvas",{class:"canvas",ref:(n,o)=>{o.canvas=n,canvas.value=n},width:unref(size),height:unref(size)},null,8,_hoisted_1$7)],2))}});var TokenRenderer=_export_sfc(_sfc_main$8,[["__scopeId","data-v-77950bdc"]]);const _hoisted_1$6={class:"text-input"},_hoisted_2$6=createBaseVNode("label",null,"forumla",-1),_hoisted_3$5=["value"],_sfc_main$7=defineComponent({props:{modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const n=a=>{var s;((s=a.key.match(/[^ \[\]a-zA-Z0-9=<>*+-\/().&^!|%;?:]/))==null?void 0:s.length)&&a.preventDefault()},o=a=>{t("update:modelValue",a.target.value)};return(a,s)=>(openBlock(),createElementBlock("div",_hoisted_1$6,[_hoisted_2$6,createBaseVNode("input",{type:"text",value:e.modelValue,onKeydown:s[0]||(s[0]=r=>n(r)),onInput:s[1]||(s[1]=r=>o(r))},null,40,_hoisted_3$5)]))}});var ParameterInput_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1$5={class:"text-input"},_hoisted_2$5=["value"],_hoisted_3$4=["value"],_sfc_main$6=defineComponent({props:{label:{type:String,required:!0},modelValue:{type:Number,required:!0,default:()=>1}},emits:["update:modelValue"],setup(e,{emit:t}){return(n,o)=>(openBlock(),createElementBlock("div",_hoisted_1$5,[createBaseVNode("label",null,toDisplayString(e.label),1),createBaseVNode("input",{type:"number",min:"0",max:"255",value:e.modelValue,onInput:o[0]||(o[0]=a=>t("update:modelValue",parseInt(a.target.value)))},null,40,_hoisted_2$5),createBaseVNode("input",{type:"range",min:"0",max:"255",step:"1",value:e.modelValue,onInput:o[1]||(o[1]=a=>t("update:modelValue",parseInt(a.target.value)))},null,40,_hoisted_3$4)]))}});var ParameterInput=_export_sfc(_sfc_main$6,[["__scopeId","data-v-bff7295e"]]),MintButton_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId$3=e=>(pushScopeId("data-v-067ec664"),e=e(),popScopeId(),e),_hoisted_1$4=["disabled"],_hoisted_2$4=_withScopeId$3(()=>createBaseVNode("span",{class:"shadow"},null,-1)),_hoisted_3$3=_withScopeId$3(()=>createBaseVNode("span",{class:"edge"},null,-1)),_hoisted_4$3=_withScopeId$3(()=>createBaseVNode("span",{class:"front"}," MINT ",-1)),_hoisted_5$2=[_hoisted_2$4,_hoisted_3$3,_hoisted_4$3],_sfc_main$5=defineComponent({props:{minting:{type:Boolean,required:!0},disabled:{type:Boolean,required:!0}},emits:["click"],setup(e,{emit:t}){return(n,o)=>(openBlock(),createElementBlock("button",{disabled:e.disabled,class:normalizeClass(["pushable",{minting:e.minting}]),onClick:o[0]||(o[0]=withModifiers(a=>t("click"),["stop","prevent"]))},_hoisted_5$2,10,_hoisted_1$4))}});var MintButton=_export_sfc(_sfc_main$5,[["__scopeId","data-v-067ec664"]]);const initMetamask=async e=>{const t=window.ethereum||window.web3&&window.web3.currentProvider;if(t){const n=new Web3Provider(t,"any");n.on("network",(h,w)=>{d(h.chainId)});const o=ref({}),a=ref([]),s=ref(0),r=h=>{a.value=h,o.value=n.getSigner()},d=h=>{s.value=h};t.on("accountsChanged",r);const i=async()=>{r(await n.listAccounts())};return{signer:o,chainId:s,accounts:a,connect:async()=>{s.value!=e&&await t.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+e.toString(16)}]}),i(),a.value.length==0&&await t.request({method:"eth_requestAccounts"})},checkConnection:i,clearListeners:()=>{t.removeListener("accountsChanged",r)}}}else return Promise.reject("For a start only Metamask \u{1F98A}")},{formatEther}=utils,contractAddress="0x70DFff3AC8EEc5cCD40B52d11702aD566E013e09",networkId=parseInt("42"),contractAbi=["function name() view returns (string)","function totalSupply() view returns (uint)","function tokenByIndex(uint index) view returns (uint)","function tokenMetadata(uint tokenId) view returns (tuple(address owner,address minter,string formula,uint8[] params,uint tokenId,uint sequence,uint burnPrice))","function allTokensMetadata() view returns (tuple[](address owner,address minter,string formula,uint8[] params,uint tokenId,uint sequence,uint burnPrice))","function tokenURI(uint tokenId) view returns (string)","function mintPrice(uint totalSupply) view returns (uint)","function burnPrice(uint sequence) view returns (uint)","function mint(string formula, uint8[] params) payable returns (uint)","function getClaimableBalance(address owner) view returns (uint)","function burn(uint tokenId) returns (boolean)","function claim() returns (boolean)"],state=reactive({totalSupply:0,accounts:[],account:computed(()=>state.accounts.length>0&&state.accounts[0].toLowerCase()||""),connected:computed(()=>state.validNetwork&&state.accounts.length>0),contractAddress,signer:void 0,listing:[],network:0,validNetwork:computed(()=>!!state.network&&state.network==networkId),nextPrice:"0",providerError:"",claimableBalance:"0"});let infuraContract;const initInfura=()=>{{const e=new InfuraProvider(networkId,"51db74c752774749a1a8aae509f4cd87");infuraContract=new Contract(contractAddress,contractAbi,e)}},fetchTokenMetadata=async e=>{let t=await infuraContract.tokenMetadata(e).catch(handleVMException);return parseTokenMetadata(t)},fetchMintPrice=async e=>{const t=await infuraContract.mintPrice(e+1);return formatEther(t)};watch(()=>state.totalSupply,async(e,t)=>{state.nextPrice=await fetchMintPrice(e)});const fetchTotalSupply=async()=>{state.totalSupply=(await infuraContract.totalSupply()).toNumber()},fetchClaimableBalance=async e=>formatEther(await infuraContract.getClaimableBalance(e));watch(()=>state.account,async(e,t)=>{e&&e.length>0&&(state.claimableBalance=await fetchClaimableBalance(e))});const parseTokenMetadata=e=>N(V({},e),{tokenId:e.tokenId.toNumber(),sequence:e.sequence.toNumber(),burnPrice:formatEther(e.burnPrice)}),fetchListing=async()=>{const e=await infuraContract.allTokensMetadata();state.listing=e.map(parseTokenMetadata).sort((t,n)=>t.tokenId>n.tokenId?-1:1)},mint=async(e,t=[],n)=>{const o=new Contract(contractAddress,contractAbi,toRaw(state.signer)),a=await o.mintPrice(n.value+1),s=await(await o.mint(e,t,{value:a}).catch(handleVMException)).wait().catch(handleVMException),r=BigNumber.from(s.logs[0].topics[3]).toNumber();return handleMintedToken(r),r},burn=async e=>{await(await new Contract(contractAddress,contractAbi,toRaw(state.signer)).burn(e).catch(handleVMException)).wait().catch(handleVMException),handleBurnedToken(e)},claim=async()=>{await(await new Contract(contractAddress,contractAbi,toRaw(state.signer)).claim().catch(handleVMException)).wait().catch(handleVMException)},handleMintedToken=async e=>{let t=await fetchTokenMetadata(e);state.listing.unshift(t),state.totalSupply+=1},handleBurnedToken=e=>{state.listing=state.listing.filter(t=>t.tokenId!=e),state.totalSupply-=1},handleVMException=e=>{let t="";if(e.code==4001)t="Signature rejected";else if(e.data.message&&e.data.message.indexOf("(")>-1){t=e.data.message.match(/'(.*?)'/)[1];let n=t.split("(")[0],o=t.match(/\((.*?)\)/)[1].replace(" ","").split(",");switch(n){case"InsufficientFunds":t=parseInsufficientFunds({available:parseInt(o[0]),required:parseInt(o[1])})}}return Promise.reject(t)},parseInsufficientFunds=e=>`Transaction minumum amount ${e.required} ETH, sent ${e.available} ETH`,ContractStateSymbol=Symbol("Contract state provider identifier"),ContractCallsSymbol=Symbol("Contract calls provider identifier"),_sfc_main$4={setup(){let e;const t=async()=>{try{await e.connect()}catch(n){n.code===4001?handleVMException(n):console.log(n)}};provide(ContractStateSymbol,toRefs(readonly(state))),provide(ContractCallsSymbol,{mint,burn,claim,connect:t,fetchTotalSupply}),onMounted(async()=>{try{e=await initMetamask(networkId)}catch(n){state.providerError=n}e&&(await e.checkConnection(),state.accounts=e.accounts,state.network=e.chainId,state.signer=e.signer,initInfura()),await fetchTotalSupply(),await fetchListing()}),onUnmounted(()=>{e&&e.clearListeners()})}};function _sfc_render(e,t,n,o,a,s){return renderSlot(e.$slots,"default")}var ContractProvider=_export_sfc(_sfc_main$4,[["render",_sfc_render]]),TokenForm_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId$2=e=>(pushScopeId("data-v-a0a1d046"),e=e(),popScopeId(),e),_hoisted_1$3={class:"center"},_hoisted_2$3={key:0},_hoisted_3$2={class:"center"},_hoisted_4$2=createTextVNode(" Current price "),_hoisted_5$1={class:"price"},_hoisted_6$1=_withScopeId$2(()=>createBaseVNode("a",{href:"https://github.com/binaries-eth/binaries#tokenomics",class:"link"},"(tokenomics info)",-1)),_hoisted_7={class:"button-container"},_hoisted_8={key:2,href:"https://metamask.io",target:"_blank"},_hoisted_9={key:0,class:"center"},_hoisted_10={key:1,class:"center"},_hoisted_11={class:"error"},_sfc_main$3=defineComponent({props:{formulaValue:{type:String,required:!0},paramsValues:{type:Array,required:!0}},emits:["update:formulaValue","update:paramsValues"],setup(e,{emit:t}){const n=e,{mint:o,burn:a,connect:s,fetchTotalSupply:r}=inject(ContractCallsSymbol),{account:d,connected:i,totalSupply:m,nextPrice:k,listing:h,providerError:w}=inject(ContractStateSymbol),_=ref({}),b=computed(()=>!!_.value),y=ref(!1),g=ref(""),x=computed(()=>_.value&&_.value.owner&&_.value.owner.toLowerCase()),E=l=>{var c,u;return((u=(c=l.match(/p[0-9]+/g))==null?void 0:c.filter((v,B,R)=>R.indexOf(v)==B))==null?void 0:u.length)||0},$=computed(()=>Object.fromEntries(unref(h).map(l=>[[l.formula,...l.params].join(","),l]))),C=l=>$.value[l.join(",")],M=watch(()=>[n.formulaValue,...n.paramsValues],(l,c)=>{const u=E(l[0]);u!=n.paramsValues.length&&(n.paramsValues.length+=u-n.paramsValues.length,t("update:paramsValues",Array.apply(null,n.paramsValues).map(v=>v||1))),_.value=C(l),t("update:formulaValue",n.formulaValue)});watch(()=>$.value,()=>{_.value=C([n.formulaValue,...n.paramsValues])});const T=async()=>{y.value=!0;const l=n.formulaValue.replace(/[ ]/g,"").replaceAll("console","").replaceAll("eval",""),c=n.paramsValues;await o(l,c,m).catch(A),y.value=!1},A=async l=>{g.value=l},P=()=>{g.value=""},q=l=>Math.floor(Math.random()*l),L=()=>{t("update:paramsValues",n.paramsValues.map(()=>q(255)))};return onMounted(async()=>{}),onUnmounted(()=>{M()}),(l,c)=>(openBlock(),createElementBlock("div",null,[createVNode(_sfc_main$7,{modelValue:e.formulaValue,"onUpdate:modelValue":c[0]||(c[0]=u=>isRef(formulaValue)?formulaValue.value=u:null)},null,8,["modelValue"]),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.paramsValues,(u,v)=>(openBlock(),createBlock(ParameterInput,{label:"P"+(v+1),modelValue:e.paramsValues[v],"onUpdate:modelValue":B=>e.paramsValues[v]=B,modelModifiers:{number:!0}},null,8,["label","modelValue","onUpdate:modelValue"]))),256)),createBaseVNode("div",_hoisted_1$3,[unref(b)?(openBlock(),createElementBlock("span",_hoisted_2$3,"These params are already minted ")):createCommentVNode("v-if",!0),createBaseVNode("span",{class:"link",onClick:c[1]||(c[1]=u=>L())},"(randomise)")]),createBaseVNode("div",_hoisted_3$2,[_hoisted_4$2,createBaseVNode("span",_hoisted_5$1,toDisplayString(unref(k))+"\u039E ",1),createBaseVNode("span",{class:"link",onClick:c[2]||(c[2]=u=>unref(r)())},"(refresh)"),_hoisted_6$1]),createBaseVNode("div",_hoisted_7,[unref(i)?(openBlock(),createBlock(MintButton,{key:0,disabled:unref(b)||y.value,minting:y.value,onClick:c[3]||(c[3]=u=>T())},null,8,["disabled","minting"])):unref(w)?unref(w)?(openBlock(),createElementBlock("a",_hoisted_8,"(install Metamask \u{1F98A} to mint)")):createCommentVNode("v-if",!0):(openBlock(),createElementBlock("span",{key:1,class:"link",onClick:c[4]||(c[4]=u=>unref(s)())},"(connect)"))]),unref(x)==unref(d)?(openBlock(),createElementBlock("div",_hoisted_9,[createBaseVNode("span",{class:"link",onClick:c[5]||(c[5]=u=>unref(a)(_.value.tokenId))},"(burn for "+toDisplayString(_.value.burnPrice)+"\u039E)",1)])):createCommentVNode("v-if",!0),g.value?(openBlock(),createElementBlock("div",_hoisted_10,[createBaseVNode("span",_hoisted_11,toDisplayString(g.value),1),createBaseVNode("span",{class:"link",onClick:c[6]||(c[6]=u=>P())}," (OK, close)")])):createCommentVNode("v-if",!0)]))}});var TokenForm=_export_sfc(_sfc_main$3,[["__scopeId","data-v-a0a1d046"]]),ConnectButton_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1$2={key:0},_hoisted_2$2={key:1},_hoisted_3$1={key:1},_hoisted_4$1={key:0,class:"with_space"},_hoisted_5=createTextVNode(" Accrued "),_hoisted_6={class:"amount"},_sfc_main$2=defineComponent({setup(e){const{connect:t,claim:n}=inject(ContractCallsSymbol),{connected:o,account:a,providerError:s,claimableBalance:r}=inject(ContractStateSymbol);return(d,i)=>(openBlock(),createElementBlock("div",null,[unref(s)?(openBlock(),createElementBlock("div",_hoisted_1$2,toDisplayString(unref(s)),1)):(openBlock(),createElementBlock("div",_hoisted_2$2,[unref(o)?(openBlock(),createElementBlock("div",_hoisted_3$1,[parseFloat(unref(r))>0?(openBlock(),createElementBlock("span",_hoisted_4$1,[_hoisted_5,createBaseVNode("span",_hoisted_6,toDisplayString(unref(r))+"\u039E ",1),createBaseVNode("span",{class:"link",onClick:i[1]||(i[1]=m=>unref(n)())},"(claim)")])):createCommentVNode("v-if",!0),createBaseVNode("span",null,"Connected as "+toDisplayString(unref(a)),1)])):(openBlock(),createElementBlock("button",{key:0,onClick:i[0]||(i[0]=m=>unref(t)()),ref:(m,k)=>{k.connect_button=m}},"CONNECT",512))]))]))}});var ConnectButton=_export_sfc(_sfc_main$2,[["__scopeId","data-v-6104fabc"]]),TokenList_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId$1=e=>(pushScopeId("data-v-38af8292"),e=e(),popScopeId(),e),_hoisted_1$1=["onClick"],_hoisted_2$1=_withScopeId$1(()=>createBaseVNode("span",{class:"shadow"},null,-1)),_sfc_main$1=defineComponent({emits:["selected"],setup(e,{emit:t}){const n=a=>{const s=JSON.parse(JSON.stringify(a));t("selected",s)},{listing:o}=inject(ContractStateSymbol);return onMounted(async()=>{}),onUnmounted(()=>{}),(a,s)=>(openBlock(),createElementBlock("section",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(o),r=>(openBlock(),createElementBlock("div",{class:"box",onClick:d=>n(r),key:r.tokenId},[_hoisted_2$1,createVNode(TokenRenderer,{class:"front",scaled:"",formula:r.formula,params:r.params,size:512},null,8,["formula","params"])],8,_hoisted_1$1))),128))]))}});var TokenList=_export_sfc(_sfc_main$1,[["__scopeId","data-v-38af8292"]]),App_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId=e=>(pushScopeId("data-v-7ba5bd90"),e=e(),popScopeId(),e),_hoisted_1={class:"container"},_hoisted_2={class:"navigation"},_hoisted_3=_withScopeId(()=>createBaseVNode("span",{class:"logo"},"BINARIES",-1)),_hoisted_4={class:"grid"},_sfc_main=defineComponent({setup(e){const t=512,n=ref("!((x ^ y) % p1)"),o=ref([7]),a=ref(!1),s=d=>{a.value=d},r=d=>{n.value=d.formula,o.value=d.params};return(d,i)=>(openBlock(),createBlock(ContractProvider,null,{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[_hoisted_3,createVNode(ConnectButton,{onConnected:s})]),createBaseVNode("div",_hoisted_4,[createVNode(TokenRenderer,{class:"shadow",formula:n.value,params:o.value,size:t},null,8,["formula","params"]),createVNode(TokenForm,{class:"editor","formula-value":n.value,"onUpdate:formula-value":i[0]||(i[0]=m=>n.value=m),"params-values":o.value,"onUpdate:params-values":i[1]||(i[1]=m=>o.value=m),connected:a.value},null,8,["formula-value","params-values","connected"])]),createVNode(TokenList,{onSelected:r})])]),_:1}))}});var App=_export_sfc(_sfc_main,[["__scopeId","data-v-7ba5bd90"]]),global="";createApp(App).mount("#app");
